<div class="main-wrapper">
  <main>
    <%
      function tempoDecorrido(data) {
        const agora = new Date();
        const post = new Date(data);
        const diff = Math.floor((agora - post) / 1000);

        if (diff < 60) return `${diff} segundos`;
        if (diff < 3600) return `${Math.floor(diff / 60)} minutos`;
        if (diff < 86400) return `${Math.floor(diff / 3600)} horas`;
        if (diff < 2592000) return `${Math.floor(diff / 86400)} dias`;

        const dia = post.getDate().toString().padStart(2, '0');
        const mes = (post.getMonth() + 1).toString().padStart(2, '0');
        const ano = post.getFullYear();
        return `em ${dia}/${mes}/${ano}`;
      }
    %>

<section id="vagas-container" class="card-grid">
  <% if (typeof vagas !== 'undefined' && vagas.length > 0) { %>
    <% vagas.forEach(vaga => { %>
      <div class="card-column">
        <div class="custom-card">
          <div class="card-content">
            <h5><%= vaga.jobTitle %></h5>

            <div class="card-inner">
              <!-- Coluna esquerda -->
              <div class="card-left">
                <p><strong>Empresa:</strong> <%= vaga.companyName %></p>
                <p><strong>Local:</strong> <%= vaga.location %></p>
                <p><strong>Tipo de Contrato:</strong> <%= vaga.contractType %></p>
                <p><strong>Jornada:</strong> <%= vaga.workSchedule %>
                  <% if (vaga.workScheduleDetails) { %> (<%= vaga.workScheduleDetails %>) <% } %>
                </p>
                <% if (vaga.salaryRange && vaga.salaryRange.length > 0) { %>
                  <p><strong>Faixa Salarial:</strong> <%= vaga.salaryRange %></p>
                <% } %>
                <% if (vaga.mission) { %>
                  <p><strong>Miss√£o:</strong> <%= vaga.mission %></p>
                <% } %>
                <% if (vaga.responsibilities) { %>
                  <p><strong>Atribui√ß√µes:</strong> <%= vaga.responsibilities %></p>
                <% } %>
                <% if (vaga.institutionalMessage) { %>
                  <p class="institutional-message"><em>üì¢ <%= vaga.institutionalMessage %></em></p>
                <% } %>
              </div>

              <!-- Coluna direita -->
              <div class="card-right">
                <% if (vaga.education || vaga.experience || vaga.technicalSkills) { %>
                  <p><strong>Requisitos Obrigat√≥rios:</strong> 
                    <% if (vaga.education) { %> Forma√ß√£o: <%= vaga.education %> <% } %>
                    <% if (vaga.education && (vaga.experience || vaga.technicalSkills)) { %>, <% } %>
                    <% if (vaga.experience) { %> Experi√™ncia: <%= vaga.experience %> <% } %>
                    <% if (vaga.technicalSkills && (vaga.education || vaga.experience)) { %>, <% } %>
                    <% if (vaga.technicalSkills) { %> Conhecimentos T√©cnicos: <%= vaga.technicalSkills %> <% } %>
                  </p>
                <% } %>

                <% if (vaga.desiredSkills) { %>
                  <p><strong>Desej√°veis:</strong> <%= vaga.desiredSkills %></p>
                <% } %>

                <% if (vaga.differentials) { %>
                  <p><strong>Diferenciais:</strong> <%= vaga.differentials %></p>
                <% } %>

                <% if (vaga.benefitsText) { %>
                  <p><strong>Benef√≠cios:</strong> <%= vaga.benefitsText %></p>
                <% } %>

                <!-- Candidatura -->
                <div class="application-info">
                  <% if (vaga.deadline) { %>
                    <p><strong>Prazo:</strong> <%= vaga.deadline %></p>
                  <% } %>
                  <% if (vaga.applicationEmail) { %>
                    <p><strong>E-mail:</strong> <a href="mailto:<%= vaga.applicationEmail %>" class="app-link"><%= vaga.applicationEmail %></a></p>
                  <% } %>
                  <% if (vaga.applicationLink) { %>
                    <p><strong>Link:</strong> <a href="<%= vaga.applicationLink %>" target="_blank" class="app-link">Acessar Link</a></p>
                  <% } %>
                  <% if (vaga.applicationSite) { %>
                    <p><strong>Site:</strong> <a href="<%= vaga.applicationSite %>" target="_blank" class="app-link">Acessar Site</a></p>
                  <% } %>
                  <% if (vaga.submissionInstructions) { %>
                    <p><strong>Instru√ß√µes:</strong> <%= vaga.submissionInstructions %></p>
                  <% } %>
                </div>
              </div>
            </div>

            <!-- Usu√°rio -->
            <div class="user-info">
              <img 
                src="<%= vaga.user?.profileImage || '/images/default-user.png' %>" 
                alt="Foto de <%= vaga.user?.firstName || 'Usu√°rio' %>" 
                class="user-photo"
              >
              <span>‚úçÔ∏è Postado por <%= vaga.user?.firstName || 'An√¥nimo' %></span>
            </div>

            <p class="meta">üïí Publicado a <%= tempoDecorrido(vaga.createdAt) %></p>
          </div>
        </div>
      </div>
    <% }) %>
  <% } else { %>
    <div class="no-vagas">
      <h4>Nenhuma vaga dispon√≠vel ainda.</h4>
      <p>Assim que algum usu√°rio publicar uma oportunidade, aparecer√° aqui!</p>
    </div>
  <% } %>
</section>


    <div id="loading" class="loading-spinner" style="display: none;">
      <span class="spinner"></span>
    </div>
  </main>
</div>
